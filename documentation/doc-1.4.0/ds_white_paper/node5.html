<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>5 Failure</TITLE><LINK href="ozdoc.css" rel="stylesheet" type="text/css"></HEAD><BODY><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node4.html#chapter.efficient">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node6.html#chapter.tools">Next &gt;&gt;</A></TD></TR></TABLE><DIV id="chapter.failures"><H1><A name="chapter.failures">5 Failure</A></H1><P> The Mozart system uses a three-state-model for remote sites. The three states are: OK, Temporarily Lost (Temp) , and Permanently Lost (Perm). At first introduction a remote site is always in the state OK, further use might change the state of the site into one of the other two states. The states are described here: </P><UL><LI><P>OK: No problem has yet been detected on the remote site. </P></LI><LI><P>Temporary Lost: Some transient kind of problems has been detected. A network fluctuation or partitioning can be the cause. </P></LI><LI><P>Permanently Lost: The site is gone and will never be contactable again. The process is gone or the machine is taken down. </P></LI></UL><P> <A href="node5.html#figure.three_states">Figure&nbsp;5.1</A> shows the transition-graph for the different states. Note that Perm is a non-transient state. </P><DIV id="figure.three_states"><HR><P><A name="figure.three_states"></A></P><DIV align="center"><IMG alt="" src="three_states.gif"></DIV><P class="caption"><STRONG>Figure&nbsp;5.1:</STRONG> Transition-graph over OK, Temp and Perm</P><HR></DIV><P> </P><P>The classification of site failures into the two categories <EM>Temp</EM> and <EM>Perm</EM>, simplifies construction of fault tolerant applications. By reflecting the failure state of an entity's home site to language level, the programmer is presented detailed information on what to expect from an entity in the future. The interpretation of the state then is: An entity in the state Temp might be accessible again while a Perm state clearly defines that the entity will never be accessible again. </P><H2><A name="label16">5.1 Handling Faults from Mozart</A></H2><P> Mozart offers different ways to instrument the behavior of distributed entities in the case of failure (also see <A href="../system/node52.html#chapter.fault">Chapter&nbsp;17 of ``System Modules''</A> and <A href="../dstutorial/node4.html#chapter.failure">Chapter&nbsp;4 of ``Distributed Programming in Mozart - A Tutorial Introduction''</A>). A fault condition can be paired together with a reaction strategy implemented by a procedure; this pair can be installed on a particular entity. When a fault occurs that matches the fault condition the reaction strategy is executed. </P><P>There are three different ways to instrument an entity's behavior when faults interfere with their usage: </P><UL><LI><P>Fault Exceptions: Fault Exceptions are per default thrown when an operation on a failed entity is attempted. The condition on when an entity is failed is set by a global fault condition. </P></LI><LI><P>Watchers: A Watcher is an asynchronous fault handler that monitors a specific entity. When the fault condition for that entity matches the installed fault condition the reaction procedure is started in a new thread. </P></LI><LI><P>Handlers: An Handlers is similar to a Watcher, but is only triggered when an operation is attempted on the particular entity. If the entity has a fault condition that matches the installed fault condition, the reaction procedure is executed instead of the operation, in the same thread. </P></LI></UL><P></P><H2><A name="label17">5.2 Fault Detection </A></H2><P>The Message Passing Layer (the Communication Layer together with the Transport Layer) monitors its channels to detect any kinds of problems. To simplify the design Perm is only detected while opening connections, while Temp is detected on an open channel as described below. </P><H3><A name="label18">5.2.1 Permanent Fault</A></H3><P>Operating system error codes are used to deduce that a remote site is permanently down. The main reason for this is that the error codes that guarantee that a process does not exists are only propagated at connection attempts. </P><H3><A name="label19">5.2.2 Temporary Faults</A></H3><P>Temporary Fault detection is done on Round Trip (RT) calculations. Each Mozart site has an Acceptable Round Trip (ART), when a RT to a remote site is higher than the ART the remote site is defined as Temp. When the RT goes down below the ART the remote site is considered OK again. The ART can be instrumented from language level. </P><P>The message passing layer constantly measures the RT to all remote sites it is connected to. RT information is piggybacked on ordinary messages to minimize the network traffic. </P><H2><A name="label20">5.3 Fault Tolerance</A></H2><P>The DS has been designed to be as fault tolerant as possible, with the limited knowledge available. The Message Passing Layer assures reliable delivery as long as it is possible. Messages to a remote site that is in the Perm state will of course not be delivered, and can therefore be discarded. If a connection is lost, a reconnect will be attempted<A href="node5.html#label22"><SUP>1</SUP></A>. </P><P>On top of this mechanism the protocols are implemented with recovery mechanisms, when possible. The mobile state protocol can bypass lost sites and avoid loss of the state. The Lock protocol, for instance, can recreate its mobile lock if it is lost. </P><H2><A name="label21">5.4 Perm and Temp on the Internet</A></H2><P>Detecting that a remote site is Perm gone on the Internet is hard, almost impossible. With dynamic addressing schemas as DHCP and and NAT's nothing can be said about the correct state of a machine. Perm is most likely detected on local LANs where distributed programs running over WANs will probably just experience Temp faults. </P></DIV><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node4.html#chapter.efficient">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node6.html#chapter.tools">Next &gt;&gt;</A></TD></TR></TABLE><HR align="left" width="30%"><DIV class="footnote"><A name="label22">1. </A>These attempts will continue until a Perm is detected, but the interval between reconnection attempts will grow to avoid harassing servers.</DIV><HR><ADDRESS><A href="http://www.sics.se/~erik">Erik&nbsp;Klintskog</A> and&nbsp;<A href="http://www.sics.se/~annan">Anna&nbsp;Neiderud</A><BR><SPAN class="version">Version 1.4.0 (20080702)</SPAN></ADDRESS></BODY></HTML>
