<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>6 Tuning the Example</TITLE><LINK href="ozdoc.css" rel="stylesheet" type="text/css"></HEAD><BODY><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node5.html#chapter.windll">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node7.html#sec.cinterfacespec">Next &gt;&gt;</A></TD></TR></TABLE><DIV id="chapter.tuning"><H1><A name="chapter.tuning">6 Tuning the Example</A></H1><P></P><P class="margin">Raising Exceptions</P><P> In line 10 the program simply returns <CODE>OZ_FAILED</CODE> if the environment variable is not defined, which is not good programming style. It should better raise an exception. This can be done using </P><BLOCKQUOTE class="code"><CODE><SPAN class="type">OZ_Return</SPAN>&nbsp;<SPAN class="functionname">OZ_raise</SPAN>(<SPAN class="type">OZ_Term</SPAN>&nbsp;<SPAN class="variablename">t</SPAN>);</CODE></BLOCKQUOTE><P> which raises the exception <CODE>t</CODE>. In our example we should replace line 10 with something like </P><BLOCKQUOTE class="code"><CODE>&nbsp;<SPAN class="keyword">return</SPAN>&nbsp;OZ_raise(OZ_atom(<SPAN class="string">&quot;envVarNotDefined&quot;</SPAN>));</CODE></BLOCKQUOTE><P> We leave as an exercise to the reader to give more informative exception, e.&nbsp;g. adding the name of the undefined variable. </P><P class="margin">Raising type errors</P><P> Furthermore an extra function is provided for raising type errors. The macro <CODE>OZ_declareAtom</CODE> used in our example makes use of this function. Type errors can be signaled using </P><BLOCKQUOTE class="code"><CODE><SPAN class="type">OZ_Return</SPAN>&nbsp;<SPAN class="functionname">OZ_typeError</SPAN>(<SPAN class="type">int</SPAN>&nbsp;<SPAN class="variablename">pos</SPAN>,&nbsp;<SPAN class="type">char</SPAN>&nbsp;*<SPAN class="variablename">expectedType</SPAN>);</CODE></BLOCKQUOTE><P> This is an exception signaling that the argument at position <CODE>pos</CODE> is incorrect and the name of the expected type is <CODE>expectedType</CODE>. </P><DIV id="sec.suspensionc"><P class="margin">Suspension of C functions</P><P> <A name="label16"></A> The macro <CODE>OZ_declareAtom</CODE> internally also makes use of facilities that allow C functions to suspend the running thread on variables. Thus <CODE>OZ_declareAtom</CODE> uses some code of the following form: </P><BLOCKQUOTE class="code"><CODE><SPAN class="keyword">if</SPAN>&nbsp;(OZ_isVariable(envVarName))&nbsp;{<BR>&nbsp;&nbsp;OZ_suspendOn(envVarName);<BR>}</CODE></BLOCKQUOTE><P></P></DIV><P>If <CODE>envVarName</CODE> is an unconstrained variable then <CODE>OZ_suspendOn</CODE> is called. <CODE>OZ_suspendOn</CODE> is a macro that takes a variable as argument and suspends the current thread. If the variable is determined the suspended thread becomes runnable in which case it will reexecute the C function <EM>from the beginning</EM>.</P><P>The application </P><BLOCKQUOTE class="code"><CODE><SPAN class="keyword">declare</SPAN>&nbsp;X&nbsp;<SPAN class="keyword">in</SPAN>&nbsp;{Browse&nbsp;{Goodies<SPAN class="keyword">.</SPAN>getenv&nbsp;X}}</CODE></BLOCKQUOTE><P> will call the C function as above. But the first argument is detected as variable and the executing thread suspends.</P><P>If we feed </P><BLOCKQUOTE class="code"><CODE>X=<SPAN class="string">'HOME'</SPAN></CODE></BLOCKQUOTE><P> the C function <CODE>BIgetenv</CODE> is called again from the beginning and the browser updates the display of the value of the environment variable as expected.</P><P></P></DIV><TABLE align="center" border="0" cellpadding="6" cellspacing="6" class="nav"><TR bgcolor="#DDDDDD"><TD><A href="node5.html#chapter.windll">&lt;&lt; Prev</A></TD><TD><A href="index.html">- Up -</A></TD><TD><A href="node7.html#sec.cinterfacespec">Next &gt;&gt;</A></TD></TR></TABLE><HR><ADDRESS><A href="http://www.ps.uni-sb.de/~mehl/">Michael&nbsp;Mehl</A>, <A href="http://www.ps.uni-sb.de/~tmueller/">Tobias&nbsp;Müller</A>, <A href="http://www.ps.uni-sb.de/~schulte/">Christian&nbsp;Schulte</A> and&nbsp;<A href="http://www.ps.uni-sb.de/~scheidhr/">Ralf&nbsp;Scheidhauer</A><BR><SPAN class="version">Version 1.4.0 (20080702)</SPAN></ADDRESS></BODY></HTML>
